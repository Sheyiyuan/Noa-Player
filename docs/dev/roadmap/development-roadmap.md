# NoaStudio — 详细开发路线图（Development Roadmap）
版本：v0.1-roadmap  
状态：Draft  
更新日期：2026-02-16

---

## 1. 目标与范围
本路线图用于把现有设计与 PRD 转化为可执行开发计划，覆盖：
- Electron 桌面基础能力
- 播放、截图、OCR、剪贴板协作、导出主链路
- i18n、测试与发布准备

不包含：
- 插件市场上线
- 云同步与账号系统
- DRM 兼容性保证

---

## 2. 交付原则（Definition of Done 总则）
每个阶段完成时必须满足：
- 功能：核心用户路径可演示
- 质量：关键模块有基础自动化测试
- 文档：设计/接口/使用说明同步更新
- 可回归：`pnpm --filter @noa-player/desktop run lint` 与 `build` 通过

---

## 3. 里程碑总览

| 阶段    | 周期（建议） | 目标             | 关键输出                                   |
| ------- | ------------ | ---------------- | ------------------------------------------ |
| Phase 0 | Week 1       | 工程与规范稳定化 | 目录规范、状态管理基线、日志与错误模型     |
| Phase 1 | Week 2-3     | 播放+截图主链路  | 播放控制、全屏截图、框选截图、素材入库     |
| Phase 2 | Week 4-5     | OCR 与内容沉淀   | OCR 流水线、素材文本检索、可复制文本       |
| Phase 3 | Week 6       | 剪贴板协作与导出 | 复制模板、剪贴板联动、Markdown+assets 导出 |
| Phase 4 | Week 7       | i18n 与体验完善  | 多语言框架、快捷键与交互一致性             |
| Phase 5 | Week 8       | 稳定性与发布准备 | 关键回归、性能基线、打包与发布清单         |

---

## 4. 分阶段任务拆解

## Phase 0：工程基建（Week 1）
### 目标
为后续功能开发建立一致的工程边界和可维护性。

### 任务
- 架构
  - 建立 renderer 分层目录：`app` / `features` / `shared`
  - 引入统一错误模型（`AppError` + 错误码）
- 状态管理
  - 选型并接入 `zustand`（或等价轻量方案）
  - 定义播放状态、集成状态（复制/导出）、素材状态最小 store
- IPC
  - IPC 响应结构统一（`{ ok, data|error }`）
  - 通道命名规范与参数校验基线
- 质量
  - 配置 Vitest 基础测试入口
  - 补充 CI 最小检查（lint + build）

### 验收标准
- 能在不改业务逻辑的前提下新增 feature 模块
- 新增 IPC 通道有模板可复用

---

## Phase 1：播放与捕获主链路（Week 2-3）
### 目标
打通“打开视频 -> 播放控制 -> 截图/框选 -> 素材入库”。

### 任务
- 播放
  - 封装 `PlaybackPort`，支持本地文件/直链/m3u8
  - 集成 `hls.js` 与 fallback 逻辑
  - 完成播放控制：play/pause/seek/rate/volume
- 画面捕获
  - Renderer Canvas 抓帧（全屏）
  - Overlay 框选截图（区域裁剪）
  - 失败降级提示（跨域不可读）
- 素材落盘
  - Main 侧保存图片与缩略图（`sharp`）
  - 建立素材表写入与读取接口

### 验收标准
- 本地视频与直链可稳定播放
- 截图成功率达到 PRD 目标，生成素材卡可见

---

## Phase 2：OCR 流水线（Week 4-5）
### 目标
让截图内容可检索、可复用、可回写到笔记。

### 任务
- OCR 实现
  - 接入 `tesseract.js`（MVP 语言包 `en+zh`）
  - OCR 任务队列与重试机制
- 数据联动
  - OCR 结果入库并绑定素材
  - 素材搜索支持 OCR 文本检索
- 交互
  - OCR 处理中状态反馈
  - OCR 失败重试与错误展示

### 验收标准
- 任一素材可触发 OCR 并回写
- OCR 文本可被搜索并可一键复制

---

## Phase 3：剪贴板协作与导出（Week 6）
### 目标
形成稳定对外交付能力（复制到系统剪贴板 + 导出会话包）。

### 任务
- 剪贴板协作
  - 实现统一复制模板：时间戳 + OCR 文本 + 图片引用
  - 支持复制文本/图片到系统剪贴板
  - 提供可配置模板（通用 Markdown 文本块）
- 导出
  - 实现 `exportSession` 完整路径（选择目录、写摘要 Markdown、复制 assets）
  - 保留来源信息、时间戳与素材引用

### 验收标准
- 从播放器到系统剪贴板的复制链路可稳定使用
- 导出文件可在常见 Markdown 阅读器正常打开

---

## Phase 4：i18n 与体验完善（Week 7）
### 目标
补齐多语言基础并完善高频交互体验。

### 任务
- i18n
  - 接入 `i18next + react-i18next`
  - 建立命名空间：`common/player/library/note/settings`
  - 落地中英双语最小词条
- 体验
  - 补齐高频快捷键（播放控制、截图、复制）
  - 统一错误提示与重试交互

### 验收标准
- UI 支持中英切换（核心页面）
- 高频操作可仅通过快捷键完成主要链路

---

## Phase 5：稳定性与发布准备（Week 8）
### 目标
以 MVP 可发布为标准做收尾。

### 任务
- 稳定性
  - 关键路径回归：播放、截图、OCR、导出
  - 性能基线记录（冷启动、截图耗时、OCR耗时）
- 打包
  - Linux 首发打包流程（AppImage/deb 二选一优先）
  - 发布清单：版本号、changelog、已知问题
- 文档
  - 安装说明、使用手册、常见问题

### 验收标准
- 完成一次端到端演示与安装包验证
- 已知问题清单可追踪

---

## 5. 并行工作流建议

| 工作流               | Owner 建议        | 可并行阶段 |
| -------------------- | ----------------- | ---------- |
| Shell & IPC          | Electron/平台工程 | Phase 0-5  |
| Player & Capture     | 前端多媒体        | Phase 1-3  |
| OCR & Search         | 算法/数据         | Phase 2-4  |
| Integration & Export | 前端应用          | Phase 3-4  |
| QA & Release         | 测试/发布         | Phase 4-5  |

---

## 6. 风险清单与应对
- 跨域视频截图失败
  - 应对：明确 UI 提示 + 本地下载后打开路径 + ffmpeg 兜底
- OCR 速度慢或识别差
  - 应对：任务队列、缓存、后续可切本地 OCR 服务
- 剪贴板内容格式不一致
  - 应对：优先通用 Markdown 模板并建立回归样例
- 需求膨胀影响 MVP
  - 应对：严格按 Phase 验收，不跨阶段加入高成本特性

---

## 7. Sprint 级任务模板（可直接建工单）
每个工单建议字段：
- 标题：`[PhaseX][Feature] 简要目标`
- 背景
- 任务清单
- 验收标准（可测试）
- 风险与回滚方案
- 关联文档（PRD/Design/IPC）

示例：
- `[Phase1][Capture] 完成 Canvas 全画面截图与素材入库`
- `[Phase2][OCR] 实现 OCR 队列与失败重试`
- `[Phase3][Clipboard] 实现复制模板并支持一键复制到剪贴板`

---

## 8. 文档联动
- 需求文档：`docs/dev/requirements/prd.md`
- 设计文档：`docs/dev/design/design.md`
- 本路线图：`docs/dev/roadmap/development-roadmap.md`
